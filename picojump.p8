pico-8 cartridge // http://www.pico-8.com
version 42
__lua__
-- picojump
-- from picozine #2

function _init()
 px=18
 py=56
 pstate=0
 pspr=1
 pdir=0
 pat=0 -- player state timer
end

function _update()
 b0=btn(⬅️)
 b1=btn(➡️)
 b2=btn(⬆️)
 px=(px+128)%128 -- no xy bounds
 pat+=1 -- update state clock
 
 --idle state
 if pstate==0 then
  pspr=1
  if (b0 or b1) change_state(1)
  if (b2) change_state(3)
  if (can_fall()) change_state(2)
 end
 
 -- walk state
 if pstate==1 then
  if (b0) pdir=-1
  if (b1) pdir=1
  px+=pdir*min(pat,2)
  pspr=flr(pat/2)%2+1
  if (not (b0 or b1)) change_state(0)
  if (b2) change_state(3)
  if (can_fall()) change_state(2) 
 end
 
 -- fall state
 if pstate==2 then
  pspr=3
  if (can_fall()) then
   if (b0) px-=1
   if (b1) px+=1
   py+=min(4,pat)
   if (not(can_fall())) py=flr(py/8)*8
  else
   py=flr(py/8)*8 -- fix y position when hitting ground
   change_state(0)
  end
 end
 
 -- jump state
 if pstate==3 then
  pspr=3
  py-=6-pat
  if (b0) px-=2
  if (b1) px+=2
  if (not(b2 or pat>7)) change_state(0)
 end
end

function _draw()
 map(0,0,0,0,16,16)
 spr(pspr,px,py,1,1,pdir==-1)
 print(pstate,1,1,5)
end

function can_fall()
 -- map tile under the player
 v=mget(
  flr((px+4)/8),
  flr((py+8)/8)
 )
 -- is it a wall?
 return not fget(v,0)
end

function change_state(s)
 pstate=s
 pat=0
end

__gfx__
0000000000bbbb0000bbbb0000b77b00ccccccccccccccccc77777cc000000000000000000000000000000000000000000000000000000000000000000000000
000000000bb77bb00bb77bb00bb74bb0cccccccccccccccc7777667c000000000000000000000000000000000000000000000000000000000000000000000000
007007000bb74bb00bb74bb00bbbbbb0ccccccccccc7777c77767767000000000000000000000000000000000000000000000000000000000000000000000000
000770000bbbbbb00bbbbbb00b33bbb0cccccccccc76677776767777000000000000000000000000000000000000000000000000000000000000000000000000
000770000bb3bb000bb3bb0003bbbb00cccccccc776776776777677f000000000000000000000000000000000000000000000000000000000000000000000000
0070070000b3bb00004b3b00000bb000cccccccccf6f777f6f77f66c000000000000000000000000000000000000000000000000000000000000000000000000
00000000000bb0000044bb220022b000ccccccccccc6666cc6666ccc000000000000000000000000000000000000000000000000000000000000000000000000
00000000002222000111022000002200cccccccccccccccccccccccc000000000000000000000000000000000000000000000000000000000000000000000000
00000000ffffffffcffffffffffffffc000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000aaaaaaaaaaaaaaaaaaaaaaaa000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000999999999999999999999999000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000999999999999999999999999000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000999999999999999999999999000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000999999999999999999999999000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000044444444c44444444444444c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000022222222cc222222222222cc000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0000000000010100000000000000000000010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0404040404040404040404040404040400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0404040404040405060404040404040400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0404041213040404040404040506040400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0404040404040404040404040404040400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0412111304041211111304040404040400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0404040404040404040404040404040400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0404041211111113040404040404040400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0404040404040404040404040404040400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0404121304040404040404040404040400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1111130404050604040404041211111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0404040404040404040412130404040400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0404040404040404041213040404040400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0404040404040412111304040404040400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0404041211130404040404040404040400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0404040404040404040404040404040400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1111111111111111111111111111111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
