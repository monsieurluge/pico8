pico-8 cartridge // http://www.pico-8.com
version 42
__lua__
-- toy train
-- from picozine #1

function _init()
 cls()
 switch_state = 0
 train = {
  {x=64,y=8},
  {x=72,y=8},
  {x=80,y=8}
 }
end

-->8
function _update()
 if (btnp(4)) then
  adv_switch()
 end
 move_train()
end

function adv_switch()
 if (switch_state < 1) then
  switch_state += 1
 else
  switch_state = 0
 end
end

function move_segment(s,dir)
 spd = dir*2
 if (s.y == 8) then
  if (s.x == 112) then
   s.y += spd
  else
   s.x += spd
  end
 elseif (s.x == 112) then
  if (s.y == 112) then
   s.x -= spd
  else
   s.y += spd
  end
 elseif (s.y == 112) then
  if (s.x == 8) then
   s.y -= spd
  else
   s.x -= spd
  end
 elseif(s.x ==8) then
  if (s.y == 8) then
   s.x += spd
  else
   s.y -= spd
  end
 end
end

function move_train()
 for s in all(train) do
  move_segment(s,switch_state)
 end
end

-->8
function _draw()
 map(0,0,0,0,16,16)
 draw_switch()
 draw_train()
end

function draw_switch()
 if (switch_state == 1) then
  sspr(0,16,16,16,56,56,16,16)
 else
  sspr(64,16,16,16,56,56,16,16)
 end
end

function draw_train()
 local len=#train
 for s=1,len do
  if (s == 1) then
   sprite = 11
  elseif (s == len) then
   sprite = 13
  else
   sprite = 12
  end
  spr(sprite,train[s].x,train[s].y)
 end
end
__gfx__
00000000000000004444444444444444444444444444444444444444667666560dddddd00dddddd00dddddd00dddddd00dddddd00dddddd00000000000000000
0000000000000000444444444444444446666666666666666666666465666666dd5dd5d0dd5dd5dd0d5dd5ddd555555dd555555dd555555d0000000000000000
0070070000000000444444444444444446655555555555555555566466666666dd5dd5d0dd5dd5dd0d5dd5ddd5dddd5dd5dddd5dd5dddd5d0000000000000000
0007700000000000444444444444444446566646646664666466456466667666dd5665606d5665d6065665ddd5dddd5dd5d55d5dd5d11d5d0000000000000000
0007700000000000444444444444444446546646646664666464656466666656dd5665606d5665d6065665ddd5dddd5dd5d55d5dd5d11d5d0000000000000000
0070070000000000444444444444444446564555555555555556656466666666dd5dd5d0dd5dd5dd0d5dd5ddd5dddd5dd5dddd5dd5dddd5d0000000000000000
0000000000000000444444444444444446566566666666666654456465666666dd5dd5d0dd5dd5dd0d5dd5ddd555555dd555555dd555555d0000000000000000
00000000000000004444444444444444465445644444444446566564666666660dddddd00dddddd00dddddd00dddddd00dddddd00dddddd00000000000000000
00000000000000004444444444444444465665644888844446566564444888840dddddd00dd66dd0000000000000000000000000000000000000000000000000
0000000000000000444444444444444446566564448778444654456444877844ddddddddddddddddddd66ddd0000000000000000000000000000000000000000
0000000000000000444444444444444446544564444877844656656448778444ddd66dddd555555dd555555d0000000000000000000000000000000000000000
0000000000000000444444444444444446566564444487784656656487784444ddd66dddddd66dddddd66ddd0000000000000000000000000000000000000000
0000000000000000444444444444444446566564444487784656656487784444ddd66dddddd66dddddd66ddd0000000000000000000000000000000000000000
0000000000000000444444444444444446566564444877844654456448778444ddddddddd555555dd555555d0000000000000000000000000000000000000000
0000000000000000444444444444444446544564448778444656656444877844ddd66ddddddddddddddddddd0000000000000000000000000000000000000000
0000000000000000444444444444444446566564488884444656656444488884000000000dd66dd00dddddd00000000000000000000000000000000000000000
00000555555000000000055555500000465665644444444446544564667666560000055775500000000000000000000000000000000000000000000000000000
00055555555550000005555555555000465445666666666666566564699599960005557777555000000000000000000000000000000000000000000000000000
0055555555577700005555555555550046566555555555555554656469995996005555dddd555500000000000000000000000000000000000000000000000000
0555555555dd7750055555555555555046566464664666466646456469555596055555dddd555550000000000000000000000000000000000000000000000000
055555555dddd750055555555555555046564664664666466646656469555596055555dddd555550000000000000000000000000000000000000000000000000
55555555ddddd555555555555555555546655555555555555555566469995996555555dddd555555000000000000000000000000000000000000000000000000
5555555ddddd5555dddddddddddddd7546666666666666666666666469959996555555dddd555555000000000000000000000000000000000000000000000000
555555ddddd55555dddddddddddddd7744444444444444444444444466666666555555dddd555555000000000000000000000000000000000000000000000000
55555ddddd555555dddddddddddddd7766766656667666566676665666766656555555dddd555555000000000000000000000000000000000000000000000000
5555ddddd5555555dddddddddddddd7565666666656666666566699559966666555555dddd555555000000000000000000000000000000000000000000000000
555ddddd55555555555555555555555566666666666666666666695995966666555555dddd555555000000000000000000000000000000000000000000000000
05ddddd555555550055555555555555066667666666676666666759959567666055555dddd555550000000000000000000000000000000000000000000000000
0ddddd5555555550055555555555555066666656666666566666659599566656055555dddd555550000000000000000000000000000000000000000000000000
00ddd55555555500005555555555550066666666666666666666695995966666005555dddd555500000000000000000000000000000000000000000000000000
000d555555555000000555555555500065666666656666666566699559966666000555dddd555000000000000000000000000000000000000000000000000000
0000055555500000000005555550000066666666666666666666666666666666000005dddd500000000000000000000000000000000000000000000000000000
__map__
0202020202020202020202020202020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0204050505052525252525252525060200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0214020202020202020202020202160200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0214020202020202020202020202160200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0214020202020202020202020202160200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0214020202020202020202020202160200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0214020202020736372702020202160200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0214020202020707070702020215161700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0214020202020707070702020202160200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0214020202020707070702020202160200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0214020202020202020202020202160200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0214020202020202020202020202160200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0214020202020202020202020202160200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0214020202020202020202020202160200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0224252525252525252525252525260200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020202020202020202020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
